@vite('resources/js/app.js')
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
    window.riwayatPratinjau = @json($riwayatPratinjau);
    console.log('Riwayat Pratinjau:', window.riwayatPratinjau);
</script>

<x-layout>
<div x-data="{
    tab: 'produk',
    produk: 'kaos',
    previewImage: '/img/kaos-default.png',
    uploadedImage: null,
    previewText: '',
    previewColor: '#00bcd4',
    uploadedX: 0,
    uploadedY: 0,
    uploadedWidth: 128,
    uploadedHeight: 128,
    uploadedRotate: 0,
    dragging: false,
    resizing: false,
    dragOffsetX: 0,
    dragOffsetY: 0,
    resizeStartX: 0,
    resizeStartY: 0,
    resizeStartWidth: 128,
    resizeStartHeight: 128,
    // Custom text state
    textX: 0,
    textY: 0,
    textRotate: 0,
    textEditing: false,
    textWidth: 120,
    textHeight: 32,
    textResizing: false,
    textResizeStartX: 0,
    textResizeStartY: 0,
    textResizeStartWidth: 120,
    textResizeStartHeight: 32,
    textDragging: false,
    textDragOffsetX: 0,
    textDragOffsetY: 0,
    textFontSize: 24,
    textColor: '#000000',
    updateImage(e) {
        const file = e.target.files[0];
        if (file) {
            this.uploadedImage = URL.createObjectURL(file);
        }
    },
    downloadPreview() {
        html2canvas(document.getElementById('preview-area')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'desain-kaos.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    },

    colorToHue(color) {
        if (!color) return 0;
        const r = parseInt(color.substr(1,2),16);
        const g = parseInt(color.substr(3,2),16);
        const b = parseInt(color.substr(5,2),16);
        const max = Math.max(r,g,b), min = Math.min(r,g,b);
        let h = 0;
        if (max === min) h = 0;
        else if (max === r) h = (60 * ((g-b)/(max-min)) + 360) % 360;
        else if (max === g) h = (60 * ((b-r)/(max-min)) + 120) % 360;
        else if (max === b) h = (60 * ((r-g)/(max-min)) + 240) % 360;
        return Math.round(h);
    },
    riwayatPratinjau: window.riwayatPratinjau,
    get filteredRiwayat() {
        // Filter berdasarkan jenis produk yang dipilih
        console.log('Filtering for produk:', this.produk);
        console.log('All riwayat:', this.riwayatPratinjau);
        const filtered = this.riwayatPratinjau.filter(item => item.jenis_produk === this.produk);
        console.log('Filtered riwayat:', filtered);
        return filtered;
    },
    setPreviewFromRiwayat() {
        if (this.filteredRiwayat.length > 0) {
            this.uploadedImage = '/storage/' + this.filteredRiwayat[0].foto_pratinjau;
        } else {
            this.uploadedImage = null;
        }
    },
    init() {
        window.addEventListener('mousemove', (e) => {
            if (this.resizing) {
                this.uploadedWidth = Math.max(32, this.resizeStartWidth + (e.clientX - this.resizeStartX));
                this.uploadedHeight = Math.max(32, this.resizeStartHeight + (e.clientY - this.resizeStartY));
            }
            if (this.dragging) {
                this.uploadedX = e.clientX - this.dragOffsetX;
                this.uploadedY = e.clientY - this.dragOffsetY;
            }
            if (this.textDragging) {
                this.textX = e.clientX - this.textDragOffsetX;
                this.textY = e.clientY - this.textDragOffsetY;
            }
            if (this.textResizing) {
                this.textWidth = Math.max(32, this.textResizeStartWidth + (e.clientX - this.textResizeStartX));
                this.textHeight = Math.max(20, this.textResizeStartHeight + (e.clientY - this.textResizeStartY));
            }
        });
        window.addEventListener('mouseup', () => {
            this.resizing = false;
            this.dragging = false;
            this.textDragging = false;
            this.textResizing = false;
        });
        window.addEventListener('touchmove', (e) => {
            if (this.resizing) {
                this.uploadedWidth = Math.max(32, this.resizeStartWidth + (e.touches[0].clientX - this.resizeStartX));
                this.uploadedHeight = Math.max(32, this.resizeStartHeight + (e.touches[0].clientY - this.resizeStartY));
            }
            if (this.dragging) {
                this.uploadedX = e.touches[0].clientX - this.dragOffsetX;
                this.uploadedY = e.touches[0].clientY - this.dragOffsetY;
            }
            if (this.textDragging) {
                this.textX = e.touches[0].clientX - this.textDragOffsetX;
                this.textY = e.touches[0].clientY - this.textDragOffsetY;
            }
            if (this.textResizing) {
                this.textWidth = Math.max(32, this.textResizeStartWidth + (e.touches[0].clientX - this.textResizeStartX));
                this.textHeight = Math.max(20, this.textResizeStartHeight + (e.touches[0].clientY - this.textResizeStartY));
            }
        });
        window.addEventListener('touchend', () => {
            this.resizing = false;
            this.dragging = false;
            this.textDragging = false;
            this.textResizing = false;
        });
    }
}" x-init="init(); setPreviewFromRiwayat(); $watch('produk', value => {
    setPreviewFromRiwayat();
    if (value === 'kaos') {
        $data.previewImage = '/img/kaos-default.png';
    } else if (value === 'kemeja') {
        $data.previewImage = '/img/kemeja-default.png';
    } else if (value === 'hoodie') {
        $data.previewImage = '/img/hoodie-default.png';
    } else if (value === 'jaket') {
        $data.previewImage = '/img/jaket-default.png';
    }
})">
    <div class="flex">
        <!-- Sidebar -->
        <div class="bg-white w-40 py-8 flex flex-col items-center gap-8 rounded-l-2xl border border-gray-200">
            <button @click="tab = 'produk'" :class="{'font-bold text-black': tab === 'produk'}" class="flex flex-col items-center gap-1 focus:outline-none">
                <!-- Ikon kaos -->
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M4 4l4-2h8l4 2v2a2 2 0 01-2 2v12a2 2 0 01-2 2H8a2 2 0 01-2-2V8a2 2 0 01-2-2V4z" />
                </svg>
                <span>Jenis Produk</span>
            </button>
            <button @click="tab = 'warna'" :class="{'font-bold text-black': tab === 'warna'}" class="flex flex-col items-center gap-1 focus:outline-none">
                <!-- Ikon palet -->
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10" />
                    <circle cx="7.5" cy="10.5" r="1.5" />
                    <circle cx="16.5" cy="10.5" r="1.5" />
                    <circle cx="12" cy="16.5" r="1.5" />
                </svg>
                <span>Warna</span>
            </button>
            <button @click="tab = 'unggah'" :class="{'font-bold text-black': tab === 'unggah'}" class="flex flex-col items-center gap-1 focus:outline-none">
                <!-- Ikon upload awan -->
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M16 16v-4a4 4 0 00-8 0v4" />
                    <path d="M12 12v6m0 0l-3-3m3 3l3-3" />
                    <path d="M20 16.58A5 5 0 0018 7h-1.26A8 8 0 104 15.25" />
                </svg>
                <span>Unggah</span>
            </button>
            <button @click="tab = 'teks'" :class="{'font-bold text-black': tab === 'teks'}" class="flex flex-col items-center gap-1 focus:outline-none">
                <!-- Ikon Aa -->
                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <text x="2" y="20" font-size="20" font-family="Arial" fill="black">Aa</text>
                </svg>
                <span>Teks</span>
            </button>
        </div>
        <!-- Main Preview Area -->
        <div class="flex-1 flex flex-col items-center justify-center bg-gray-100 rounded-r-2xl p-8">
            <!-- Pratinjau Produk -->
            <div id="preview-area" class="relative w-96 h-[500px] flex items-center justify-center rounded-xl shadow mb-6">
                <!-- SVG kaos dengan warna dinamis -->
                <svg version="1.1" xmlns="http://www.w3.org/3000/svg" width="100%" height="100%" viewBox="0 0 1024 1024" preserveAspectRatio="xMidYMid meet" class="absolute inset-0 w-full h-full z-10">
                  <g transform="translate(120,80) scale(1.5)">
                    <path id="kaos-body" :fill="previewColor" d="M0 0 C0.75455978 -0.00467285 1.50911957 -0.0093457 2.2865448 -0.01416016 C6.93679246 -0.00007886 10.50927187 0.66975729 14.875 2.125 C15.33648438 2.74246094 15.79796875 3.35992187 16.2734375 3.99609375 C18.60721551 7.09831085 21.63598341 8.66042192 24.9140625 10.66015625 C26.875 12.125 26.875 12.125 27.875 15.125 C28.865 15.455 29.855 15.785 30.875 16.125 C31.57235235 17.85177725 32.26784187 19.57935675 32.94921875 21.3125 C34.16545244 23.6936495 35.97986541 24.98072514 38.08203125 26.57421875 C43.25686427 31.05005472 47.34952884 36.96028797 51.3125 42.5078125 C51.90937622 43.33526978 51.90937622 43.33526978 52.51831055 44.17944336 C53.635362 45.73967664 54.73417259 47.31292137 55.83203125 48.88671875 C56.84330078 49.99466797 56.84330078 49.99466797 57.875 51.125 C59.195 51.125 60.515 51.125 61.875 51.125 C62.205 53.105 62.535 55.085 62.875 57.125 C65.845 57.125 68.815 57.125 71.875 57.125 C71.875 57.785 71.875 58.445 71.875 59.125 C74.185 58.795 76.495 58.465 78.875 58.125 C79.25718767 59.78114657 79.58895102 61.44957024 79.875 63.125 C79.545 63.455 79.215 63.785 78.875 64.125 C82.64868655 64.91946033 86.0469234 65.1051952 89.875 64.9375 C94.8318864 64.85513482 97.12034298 65.96318357 100.875 69.125 C100.875 68.465 100.875 67.805 100.875 67.125 C101.535 67.125 102.195 67.125 102.875 67.125 C103.205 68.445 103.535 69.765 103.875 71.125 C103.215 71.455 102.555 71.785 101.875 72.125 C107.76470274 72.8923902 107.76470274 72.8923902 113.6875 73 C116.56703415 73.16454481 117.82479842 74.15073181 119.875 76.125 C119.875 76.785 119.875 77.445 119.875 78.125 C124.97834017 80.030247 129.33842706 81.55089023 134.875 81.125 C134.875 81.785 134.875 82.445 134.875 83.125 C137.185 82.795 139.495 82.465 141.875 82.125 C142.308125 82.90875 142.74125 83.6925 143.1875 84.5 C144.76720247 87.34198375 144.76720247 87.34198375 147.875 89.125 C148.535 88.795 149.195 88.465 149.875 88.125 C151.93359375 88.140625 151.93359375 88.140625 154.3125 88.375 C155.48619141 88.47554687 155.48619141 88.47554687 156.68359375 88.578125 C159.28072169 89.22624962 160.10240564 90.17563723 161.875 92.125 C162.90625 92.640625 163.9375 93.15625 165 93.6875 C167.875 95.125 167.875 95.125 168.875 97.125 C170.855 97.125 172.835 97.125 174.875 97.125 C174.875 97.785 174.875 98.445 174.875 99.125 C176.525 98.465 178.175 97.805 179.875 97.125 C180.6484375 97.99125 180.6484375 97.99125 181.4375 98.875 C184.38347463 101.59436119 187.34933671 103.22656592 190.875 105.125 C190.875 106.115 190.875 107.105 190.875 108.125 C191.205 107.465 191.535 106.805 191.875 106.125 C199.50576923 107.60192308 199.50576923 107.60192308 201.375 110.25 C201.54 110.86875 201.705 111.4875 201.875 112.125 C202.205 111.465 202.535 110.805 202.875 110.125 C203.535 110.785 204.195 111.445 204.875 112.125 C205.535 112.125 206.195 112.125 206.875 112.125 C213.27798507 112.70708955 213.27798507 112.70708955 215.75 114.4375 C217.00461825 116.31942737 217.37841267 117.93550133 217.875 120.125 C218.77992188 120.19847656 218.77992188 120.19847656 219.703125 120.2734375 C220.50234375 120.34820312 221.3015625 120.42296875 222.125 120.5 C222.91390625 120.56960937 223.7028125 120.63921875 224.515625 120.7109375 C227.01473604 121.14952321 228.74437032 121.75024781 230.875 123.125 C231.54166667 125.125 232.20833333 127.125 232.875 129.125 C234.50246694 130.82996537 236.16391311 132.50397032 237.875 134.125 C237.875 134.785 237.875 135.445 237.875 136.125 C240.845 136.455 243.815 136.785 246.875 137.125 C246.730625 138.094375 246.58625 139.06375 246.4375 140.0625 C246.42773205 144.82925938 248.96786602 147.82225754 251.91796875 151.3671875 C253.87422184 153.44212852 253.87422184 153.44212852 257.3125 153.6875 C258.158125 153.501875 259.00375 153.31625 259.875 153.125 C261.875 159.125 261.875 159.125 262.6171875 161.93359375 C264.13486708 165.78435218 266.4038334 168.51901255 269.125 171.5625 C270.12400057 172.70025516 271.12270105 173.83827389 272.12109375 174.9765625 C272.5991748 175.51700195 273.07725586 176.05744141 273.56982422 176.61425781 C275.19282612 178.49288403 276.67905992 180.46647163 278.1875 182.4375 C280.64788171 185.44464296 280.64788171 185.44464296 284.25 185.5625 C285.11625 185.418125 285.9825 185.27375 286.875 185.125 C286.875 187.765 286.875 190.405 286.875 193.125 C287.82375 193.08375 288.7725 193.0425 289.75 193 C292.875 193.125 292.875 193.125 294.875 195.125 C295.04296875 197.0078125 295.04296875 197.0078125 295.0625 199.25 C295.52459473 204.24540336 297.43351772 206.51257122 300.85546875 210.0390625 C302.98266094 212.23620105 304.85897621 214.53487659 306.75 216.9375 C307.41128906 217.76765625 308.07257812 218.5978125 308.75390625 219.453125 C310.26508414 221.3567082 311.77249409 223.26328518 313.27734375 225.171875 C314.07269531 226.16703125 314.86804688 227.1621875 315.6875 228.1875 C316.41582031 229.10660156 317.14414062 230.02570313 317.89453125 230.97265625 C319.76940873 233.35868768 319.76940873 233.35868768 322.875 234.125 C322.875 235.115 322.875 236.105 322.875 237.125 C324.81397879 239.79898476 324.81397879 239.79898476 326.875 242.125 C328.525 241.795 330.175 241.465 331.875 241.125 C332.205 242.445 332.535 243.765 332.875 245.125 C333.535 245.125 334.195 245.125 334.875 245.125 C334.875 246.445 334.875 247.765 334.875 249.125 C335.535 249.455 336.195 249.785 336.875 250.125 C336.215 250.785 335.555 251.445 334.875 252.125 C335.64070312 252.929375 335.64070312 252.929375 336.421875 253.75 C341.78870061 259.53551414 346.52732348 265.57816122 351.19775391 271.9284668 C355.24963609 277.39444166 359.55730635 282.58160874 364.04223633 287.69628906 C366.1568866 290.10789022 368.09217771 292.45076656 369.875 295.125 C370.535 294.795 371.195 294.465 371.875 294.125 C374.39759061 296.09920135 374.8679808 297.09245642 375.5625 300.3125 C375.665625 301.240625 375.76875 302.16875 375.875 303.125 C376.535 303.125 377.195 303.125 377.875 303.125 C381.68269231 303.93269231 381.68269231 303.93269231 382.875 305.125 C382.936875 306.8575 382.936875 306.8575 383 308.625 C383.58797687 314.31909181 387.19887762 317.97856432 390.875 322.125 C392.525 321.795 394.175 321.465 395.875 321.125 C396.205 322.115 396.535 323.105 396.875 324.125 C397.535 324.125 398.195 324.125 398.875 324.125 C399.875 330.75 399.875 330.75 399.875 334.125 C401.7205153 336.93289883 401.7205153 336.93289883 404.125 339.8125 C404.91390625 340.80636719 405.7028125 341.80023438 406.515625 342.82421875 C408.80304584 345.5904406 408.80304584 345.5904406 412.875 345.125 C413.535 347.765 414.195 350.405 414.875 353.125 C414.215 353.125 413.555 353.125 412.875 353.125 C413.205 354.115 413.535 355.105 413.875 356.125 C413.375 358.25 413.375 358.25 411.875 360.125 C408.25 360.875 408.25 360.875 404.875 361.125 C404.875 361.785 404.875 362.445 404.875 363.125 C403.885 363.455 402.895 363.785 401.875 364.125 C401.545 365.115 401.215 366.105 400.875 367.125 C398.875 369.125 398.875 369.125 395.9375 370.0625 C393.01803048 371.07537718 391.69845149 371.69373134 389.875 374.125 C389.875 374.785 389.875 375.445 389.875 376.125 C387.565 376.455 385.255 376.785 382.875 377.125 C382.875 378.775 382.875 380.425 382.875 382.125 C381.885 382.62 381.885 382.62 380.875 383.125 C380.545 383.785 380.215 384.445 379.875 385.125 C378.225 385.125 376.575 385.125 374.875 385.125 C374.545 386.445 374.215 387.765 373.875 389.125 C373.215 389.125 372.555 389.125 371.875 389.125 C370.53099167 390.11060611 369.19892972 391.11258315 367.875 392.125 C366.54166667 392.79166667 365.20833333 393.45833333 363.875 394.125 C363.215 394.785 362.555 395.445 361.875 396.125 C360.885 396.455 359.895 396.785 358.875 397.125 C358.545 398.115 358.215 399.105 357.875 400.125 C355.565 400.455 353.255 400.785 350.875 401.125 C351.205 402.445 351.535 403.765 351.875 405.125 C347.375 409.125 347.375 409.125 342.875 409.125 C342.875 411.105 342.875 413.085 342.875 415.125 C342.215 414.795 341.555 414.465 340.875 414.125 C340.545 414.785 340.215 415.445 339.875 416.125 C338.54166667 416.45833333 337.20833333 416.79166667 335.875 417.125 C335.545 417.785 335.215 418.445 334.875 419.125 C333.225 419.125 331.575 419.125 329.875 419.125 C329.545 420.445 329.215 421.765 328.875 423.125 C328.215 423.125 327.555 423.125 326.875 423.125 C326.875 423.785 326.875 424.445 326.875 425.125 C325.7921875 425.1559375 325.7921875 425.1559375 324.6875 425.1875 C321.47397913 426.25867362 321.13990535 426.88519455 319.375 429.625 C317.1875 433.02083333 317.1875 433.02083333 314.0625 434.0625 C312.9796875 434.0934375 312.9796875 434.0934375 311.875 434.125 C311.215 436.435 310.555 438.745 309.875 441.125 C307.565 441.125 305.255 441.125 302.875 441.125 C302.875 443.105 302.875 445.085 302.875 447.125 C302.215 447.125 301.555 447.125 300.875 447.125 C300.215 447.785 299.555 448.445 298.875 449.125 C297.885 449.125 296.895 449.125 295.875 449.125 C293.86348259 449.75606429 291.86136298 450.41873761 289.875 451.125 C289.875 451.785 289.875 452.445 289.875 453.125 C289.215 453.125 288.555 453.125 287.875 453.125 C287.8440625 454.0221875 287.8440625 454.0221875 287.8125 454.9375 C286.33241798 458.39102472 283.22132542 458.71602088 279.875 460.125 C279.545 460.805625 279.215 461.48625 278.875 462.1875 C278.545 462.826875 278.215 463.46625 277.875 464.125 C275.54166667 464.79166667 273.20833333 465.45833333 270.875 466.125 C269.42280623 468.02668356 269.42280623 468.02668356 268.875 470.125 C267.25133534 473.37232932 264.12112161 473.82655136 260.875 475.125 C260.875 476.115 260.875 477.105 260.875 478.125 C260.215 478.125 259.555 478.125 258.875 478.125 C258.235625 478.95 257.59625 479.775 256.9375 480.625 C256.256875 481.45 255.57625 482.275 254.875 483.125 C253.885 483.125 252.895 483.125 251.875 483.125 C251.545 483.785 251.215 484.445 250.875 485.125 C249.885 485.125 248.895 485.125 247.875 485.125 C247.875 485.785 247.875 486.445 247.875 487.125 C245.24015136 487.8569024 243.50062573 488.34005885 240.875 487.4375 C238.38753359 485.80510017 236.09994195 484.10272618 233.875 482.125 C233.875 481.465 233.875 480.805 233.875 480.125 C233.235625 480.00125 232.59625 479.8775 231.9375 479.75 C231.256875 479.54375 230.57625 479.3375 229.875 479.125 C229.545 478.465 229.215 477.805 228.875 477.125 C227.885 477.62 227.885 477.62 226.875 478.125 C226.545 477.135 226.215 476.145 225.875 475.125 C224.885 475.125 223.895 475.125 222.875 475.125 C222.875 474.465 222.875 473.805 222.875 473.125 C223.535 473.125 224.195 473.125 224.875 473.125 C224.875 472.465 224.875 471.805 224.875 471.125 C223.92625 471.021875 222.9775 470.91875 222 470.8125 C218.875 470.125 218.875 470.125 216.875 467.125 C216.215 466.795 215.555 466.465 214.875 466.125 C215.060625 466.888125 215.24625 467.65125 215.4375 468.4375 C215.875 471.125 215.875 471.125 214.875 474.125 C214.77798073 476.92714466 214.73580368 479.69859348 214.75 482.5 C214.74613281 483.25539063 214.74226562 484.01078125 214.73828125 484.7890625 C214.74517249 488.73085401 215.07767439 492.25434656 215.875 496.125 C215.545 496.785 215.215 497.445 214.875 498.125 C215.20300412 499.79272365 215.53747099 501.45917796 215.875 503.125 C215.94378101 505.36622912 215.9597395 507.60938851 215.9375 509.8515625 C215.92976562 511.1303125 215.92203125 512.4090625 215.9140625 513.7265625 C215.90162625 515.06771388 215.8885992 516.40885991 215.875 517.75 C215.84839127 520.38806552 215.82848899 523.02587846 215.8125 525.6640625 C215.79509766 527.41517334 215.79509766 527.41517334 215.77734375 529.20166016 C215.73843706 532.189274 215.73843706 532.189274 216.875 535.125 C216.55248488 536.79379384 216.21682545 538.46005428 215.875 540.125 C215.75620788 542.72185099 215.68536405 545.27890752 215.6875 547.875 C215.68613037 548.58366211 215.68476074 549.29232422 215.68334961 550.02246094 C215.73279629 555.35781918 216.58868237 559.97972949 217.875 565.125 C217.70871094 565.75921875 217.54242187 566.3934375 217.37109375 567.046875 C216.7140507 569.14774271 216.7140507 569.14774271 217.34008789 571.3684082 C217.93249668 574.42130077 217.97130815 577.19988773 217.9375 580.30859375 C217.92976562 581.48357422 217.92203125 582.65855469 217.9140625 583.86914062 C217.88806214 586.3274744 217.86202061 588.78580773 217.8359375 591.24414062 C217.82820312 592.42041016 217.82046875 593.59667969 217.8125 594.80859375 C217.79509766 596.41045532 217.79509766 596.41045532 217.77734375 598.04467773 C217.87606339 601.15854205 218.33598096 604.0606452 218.875 607.125 C218.91751825 609.70798341 218.91583811 612.29198948 218.875 614.875 C218.58937659 619.66778093 218.58937659 619.66778093 219.875 624.125 C219.215 624.125 218.555 624.125 217.875 624.125 C218.225625 624.681875 218.57625 625.23875 218.9375 625.8125 C219.875 628.125 219.875 628.125 219.375 630.5625 C218.62222755 633.13628306 218.62222755 633.13628306 219.87109375 635.4296875 C221.04220448 638.57391475 220.87448534 640.51033245 220.4375 643.8125 C219.79461992 647.60689111 219.79461992 647.60689111 220.875 651.125 C220.875 653.125 220.875 655.125 220.875 657.125 C221.17904678 658.79725729 221.50628912 660.46580104 221.875 662.125 C221.875 663.79166667 221.875 665.45833333 221.875 667.125 C221.215 667.125 220.555 667.125 219.875 667.125 C219.875 667.785 219.875 668.445 219.875 669.125 C220.535 669.455 221.195 669.785 221.875 670.125 C221.28696203 673.14919525 220.64821882 676.14258453 219.875 679.125 C220.535 679.125 221.195 679.125 221.875 679.125 C221.84244792 681.14322917 221.80989583 683.16145833 221.77734375 685.1796875 C221.74850758 687.20685404 221.74850758 687.20685404 222.875 689.125 C222.215 689.785 221.555 690.445 220.875 691.125 C220.81577803 693.37078505 220.81577803 693.37078505 221.1875 695.875 C221.29449219 696.77605469 221.40148437 697.67710937 221.51171875 698.60546875 C221.78138602 700.47574172 222.12215274 702.33604844 222.5 704.1875 C222.93905824 707.62678956 222.59566142 710.65331691 221.875 714.07421875 C221.81356431 716.27680472 221.81356431 716.27680472 221.875 719.125 C221.86361105 720.71875239 221.85184853 722.31250213 221.83984375 723.90625 C221.83053849 725.81249908 221.82143156 727.71874913 221.8125 729.625 C221.80412109 730.58792969 221.79574219 731.55085937 221.78710938 732.54296875 C221.78388672 733.46722656 221.78066406 734.39148438 221.77734375 735.34375 C221.77210693 736.18873047 221.76687012 737.03371094 221.76147461 737.90429688 C221.78471402 740.29977643 221.78471402 740.29977643 222.875 743.125 C222.55449202 745.46012959 222.21903308 747.79322025 221.875 750.125 C221.72778814 754.61496184 221.92791833 758.85200589 222.4375 763.3125 C222.83498175 766.86805594 222.69826631 769.62611819 221.875 773.125 C222.04 773.785 222.205 774.445 222.375 775.125 C223.01733891 777.69435563 222.40209832 779.55539568 221.875 782.125 C222.205 783.115 222.535 784.105 222.875 785.125 C222.58240515 787.13136471 222.24866113 789.13214063 221.875 791.125 C221.875 794.53637757 222.38440156 797.75213572 222.875 801.125 C222.875 822.125 222.875 843.125 222.875 864.125 C222.89820313 865.16914062 222.92140625 866.21328125 222.9453125 867.2890625 C222.97238281 869.00222656 222.97238281 869.00222656 223 870.75 C223.03480469 872.47089844 223.03480469 872.47089844 223.0703125 874.2265625 C222.81908224 877.95481958 221.44095915 878.55904085 218.875 881.125 C217.555 881.125 216.235 881.125 214.875 881.125 C214.545 882.115 214.215 883.105 213.875 884.125 C211.58608972 885.49834617 209.41747553 886.27750816 206.875 887.125 C206.875 887.785 206.875 888.445 206.875 889.125 C204.565 889.785 202.255 890.445 199.875 891.125 C199.875 891.785 199.875 892.445 199.875 893.125 C198.76125 893.558125 197.6475 893.99125 196.5 894.4375 C192.69987666 895.82411119 192.69987666 895.82411119 190.875 899.125 C189.885 899.125 188.895 899.125 187.875 899.125 C187.545 899.785 187.215 900.445 186.875 901.125 C185.8125 903.125 185.8125 903.125 183.875 905.125 C182.00390625 905.65234375 182.00390625 905.65234375 179.875 906.0625 C177.75297881 906.44308427 177.75297881 906.44308427 175.875 907.125 C174.2303326 909.58826712 174.2303326 909.58826712 172.875 912.125 C169.875 913.375 169.875 913.375 166.875 914.125 C165.885 914.455 164.895 914.785 163.875 915.125 C163.875 915.785 163.875 916.445 163.875 917.125 C160.96958423 919.35473769 158.77851179 920.98125949 155.125 921.5625 C154.3825 921.748125 153.64 921.93375 152.875 922.125 C151.50033375 924.60136012 151.50033375 924.60136012 150.875 927.125 C150.215 926.795 149.555 926.465 148.875 926.125 C148.1325 926.599375 147.39 927.07375 146.625 927.5625 C143.43749546 929.37358213 141.48036265 929.37653693 137.875 929.125 C137.545 929.785 137.215 930.445 136.875 931.125 C135.89746356 932.14696992 134.8944119 933.14479625 133.875 934.125 C133.24078125 934.88296875 133.24078125 934.88296875 132.59375 935.65625 C130.36474327 937.56103757 128.6283844 937.75532275 125.75 938.1875 C123.12682793 938.54703529 123.12682793 938.54703529 120.875 939.125 C120.545 939.785 120.215 940.445 119.875 941.125 C117.80859375 941.7578125 117.80859375 941.7578125 115.3125 942.25 C114.07306641 942.50136719 114.07306641 942.50136719 112.80859375 942.7578125 C112.17050781 942.87898437 111.53242187 943.00015625 110.875 943.125 C110.875 943.785 110.875 944.445 110.875 945.125 C105.595 945.785 100.315 946.445 94.875 947.125 C94.875 948.115 94.875 949.105 94.875 950.125 C93.885 950.125 92.895 950.125 91.875 950.125 C91.545 950.785 91.215 951.445 90.875 952.125 C89.885 951.795 88.895 951.465 87.875 951.125 C87.875 951.785 87.875 952.445 87.875 953.125 C87.21113281 953.18558594 86.54726563 953.24617187 85.86328125 953.30859375 C78.03319187 953.82042304 78.03319187 953.82042304 70.6875 956.25 C70.089375 956.53875 69.49125 956.8275 68.875 957.125 C68.215 956.795 67.555 956.465 66.875 956.125 C66.875 956.785 66.875 957.445 66.875 958.125 C65.946875 958.310625 65.946875 958.310625 65 958.5 C62.68379168 958.99697356 62.68379168 958.99697356 60.875 961.125 C58.69189453 961.42797852 58.69189453 961.42797852 56.0078125 961.50390625 C54.55568359 961.55514648 54.55568359 961.55514648 53.07421875 961.60742188 C52.05972656 961.63384766 51.04523437 961.66027344 50 961.6875 C48.00248948 961.74760435 46.00508216 961.81126963 44.0078125 961.87890625 C43.11980957 961.90283447 42.23180664 961.9267627 41.31689453 961.95141602 C37.15933645 962.24695929 33.70705685 963.52830965 29.875 965.125 C29.875 964.465 29.875 963.805 29.875 963.125 C28.946875 963.434375 28.01875 963.74375 27.0625 964.0625 C23.19144708 965.35285097 20.2587411 966.24650349 16.1875 966.1875 C15.37925781 966.17847656 14.57101562 966.16945313 13.73828125 966.16015625 C12.81595703 966.14275391 12.81595703 966.14275391 11.875 966.125 C11.545 966.785 11.215 967.445 10.875 968.125 C9.92625 967.939375 8.9775 967.75375 8 967.5625 C4.97631207 966.83813368 4.97631207 966.83813368 2.875 968.125 C1.19845271 967.84557545 -0.47108154 967.51671753 -2.125 967.125 C-2.125 967.785 -2.125 968.445 -2.125 969.125 C-4.105 968.465 -6.085 967.805 -8.125 967.125 C-8.125 967.785 -8.125 968.445 -8.125 969.125 C-18.12213708 969.27939492 -28.11934563 969.42756868 -38.11668968 969.5679636 C-42.7596476 969.63335771 -47.40255515 969.70083452 -52.04541016 969.77319336 C-56.53222184 969.8430416 -61.01908305 969.90725917 -65.50603104 969.96769524 C-67.21152255 969.99163315 -68.91698761 970.01754517 -70.62241745 970.04553413 C-86.83840932 970.30931041 -86.83840932 970.30931041 -94.10171509 969.3480072 C-96.39524779 969.09521319 -98.63156169 969.09101986 -100.9375 969.125 C-104.16918578 969.17011952 -106.9530078 968.75939844 -110.125 968.125 C-112.40658623 968.09144726 -114.68329573 968.12577857 -116.96484375 968.15625 C-119.44459719 968.12037653 -121.7255124 967.74422261 -124.125 967.125 C-124.455 967.785 -124.785 968.445 -125.125 969.125 C-126.011875 968.795 -126.89875 968.465 -127.8125 968.125 C-132.52150488 966.73829918 -137.17659527 967.06520315 -142.0390625 967.25 C-145.19659449 967.12209997 -147.29155065 966.47325843 -150.125 965.125 C-150.455 965.785 -150.785 966.445 -151.125 967.125 C-151.125 966.465 -151.125 965.805 -151.125 965.125 C-151.785 965.125 -152.445 965.125 -153.125 965.125 C-153.455 965.785 -153.785 966.445 -154.125 967.125 C-154.929375 966.83625 -155.73375 966.5475 -156.5625 966.25 C-163.92418324 963.92525792 -171.55738078 962.61008603 -179.125 961.125 C-179.455 961.785 -179.785 962.445 -180.125 963.125 C-180.125 962.465 -180.125 961.805 -180.125 961.125 C-182.0740625 961.24875 -182.0740625 961.24875 -184.0625 961.375 C-189.43424641 961.40910633 -193.4425455 959.60459766 -198.125 957.125 C-198.455 957.785 -198.785 958.445 -199.125 959.125 C-200.053125 958.795 -200.98125 958.465 -201.9375 958.125 C-205.04529291 956.97532996 -205.04529291 956.97532996 -208.125 957.125 C-208.785 957.125 -209.445 957.125 -210.125 957.125 C-210.125 956.465 -210.125 955.805 -210.125 955.125 C-210.90875 955.0425 -211.6925 954.96 -212.5 954.875 C-215.64440886 954.22443265 -218.07231084 953.37197872 -221 952.125 C-225.45704185 950.26114614 -229.31958293 949.48095682 -234.125 949.125 C-234.125 948.465 -234.125 947.805 -234.125 947.125 C-235.115 947.125 -236.105 947.125 -237.125 947.125 C-237.125 946.465 -237.125 945.805 -237.125 945.125 C-238.424375 945.186875 -238.424375 945.186875 -239.75 945.25 C-243.24858468 945.12042279 -245.87051597 944.36480344 -249.125 943.125 C-249.125 942.465 -249.125 941.805 -249.125 941.125 C-250.445 942.115 -251.765 943.105 -253.125 944.125 C-253.125 942.475 -253.125 940.825 -253.125 939.125 C-256.70827753 938.12282936 -256.70827753 938.12282936 -260.125 939.125 C-260.455 937.805 -260.785 936.485 -261.125 935.125 C-262.115 935.455 -263.105 935.785 -264.125 936.125 C-266.8125 934.8125 -266.8125 934.8125 -269.125 933.125 C-269.125 932.465 -269.125 931.805 -269.125 931.125 C-270.0325 931.00125 -270.94 930.8775 -271.875 930.75 C-274.75355172 930.19643236 -276.60150196 929.51727478 -279.125 928.125 C-280.115 927.795 -281.105 927.465 -282.125 927.125 C-282.125 926.465 -282.125 925.805 -282.125 925.125 C-283.115 925.125 -284.105 925.125 -285.125 925.125 C-285.455 924.465 -285.785 923.805 -286.125 923.125 C-287.445 923.455 -288.765 923.785 -290.125 924.125 C-290.455 922.805 -290.785 921.485 -291.125 920.125 C-291.785 920.125 -292.445 920.125 -293.125 920.125 C-293.125 919.465 -293.125 918.805 -293.125 918.125 C-294.094375 917.856875 -295.06375 917.58875 -296.0625 917.3125 C-297.5784375 916.7246875 -297.5784375 916.7246875 -299.125 916.125 C-299.455 915.135 -299.785 914.145 -300.125 913.125 C-302.11617408 912.43241771 -304.1171136 911.76752365 -306.125 911.125 C-306.599375 910.609375 -307.07375 910.09375 -307.5625 909.5625 C-310.04948594 907.27447293 -312.863099 907.43272651 -316.125 907.125 C-315.795 906.135 -315.465 905.145 -315.125 904.125 C-317.61564888 903.43792445 -319.50386292 903.125 -322.125 903.125 C-324.125 901.125 -326.125 899.125 -328.125 897.125 C-329.115 897.455 -330.105 897.785 -331.125 898.125 C-331.125 897.465 -331.125 896.805 -331.125 896.125 C-331.785 896.125 -332.445 896.125 -333.125 896.125 C-333.125 895.465 -333.125 894.805 -333.125 894.125 C-334.445 893.795 -335.765 893.465 -337.125 893.125 C-337.455 893.785 -337.785 894.445 -338.125 895.125 C-339.625 893.75 -339.625 893.75 -341.125 892.125 C-341.125 891.465 -341.125 890.805 -341.125 890.125 C-342.115 889.795 -343.105 889.465 -344.125 889.125 C-344.125 888.465 -344.125 887.805 -344.125 887.125 C-344.785 887.125 -345.445 887.125 -346.125 887.125 C-347.5856285 884.47761084 -348.125 883.23051666 -348.125 880.125 C-348.785 880.125 -349.445 880.125 -350.125 880.125 C-350.125 877.155 -350.125 874.185 -350.125 871.125 C-350.785 870.795 -351.445 870.465 -352.125 870.125 C-351.7846875 868.4853125 -351.7846875 868.4853125 -351.4375 866.8125 C-350.72353617 863.21968727 -350.72353617 863.21968727 -352.5625 861.1875 C-353.078125 860.836875 -353.59375 860.48625 -354.125 860.125 C-353.135 859.465 -352.145 858.805 -351.125 858.125 C-350.64640822 855.83029877 -350.64640822 855.83029877 -350.75 853.25 C-350.74226562 852.38632812 -350.73453125 851.52265625 -350.7265625 850.6328125 C-351.19035859 847.71362532 -352.19509829 846.32039084 -354.125 844.125 C-353.135 843.465 -352.145 842.805 -351.125 842.125 C-350.76202064 840.14752878 -350.76202064 840.14752878 -350.9375 838 C-350.999375 836.72125 -351.06125 835.4425 -351.125 834.125 C-350.465 834.125 -349.805 834.125 -349.125 834.125 C-349.49625 833.3825 -349.8675 832.64 -350.25 831.875 C-351.125 829.125 -351.125 829.125 -350.25 826.9375 C-349.693125 826.0403125 -349.693125 826.0403125 -349.125 825.125 C-349.125 824.465 -349.125 823.805 -349.125 823.125 C-349.785 823.125 -350.445 823.125 -351.125 823.125 C-351.25 818.375 -351.25 818.375 -350.125 816.125 C-350.29 815.50625 -350.455 814.8875 -350.625 814.25 C-351.20190112 811.79817022 -350.72667087 810.53168348 -350.125 808.125 C-350.50407282 805.93796615 -350.50407282 805.93796615 -351.125 804.125 C-350.465 804.125 -349.805 804.125 -349.125 804.125 C-349.785 801.815 -350.445 799.505 -351.125 797.125 C-350.465 796.795 -349.805 796.465 -349.125 796.125 C-349.785 793.485 -350.445 790.845 -351.125 788.125 C-350.465 788.125 -349.805 788.125 -349.125 788.125 C-349.125 787.42632813 -349.125 786.72765625 -349.125 786.0078125 C-349.125 773.12" />
                    </g>
                  </svg>
                </template>
                <template x-if="produk === 'kemeja'">
                  <svg width="100%" height="100%" viewBox="0 0 300 300" preserveAspectRatio="xMidYMid meet" class="absolute inset-0 w-full h-full z-10">
                    <!-- Kemeja sederhana: badan, kerah, lengan -->
                    <g transform="translate(40,20) scale(1.1)">
                      <!-- Badan kemeja -->
                      <rect x="60" y="60" width="100" height="140" rx="18" :fill="previewColor" />
                      <!-- Lengan kiri -->
                      <rect x="20" y="80" width="40" height="90" rx="12" :fill="previewColor" />
                      <!-- Lengan kanan -->
                      <rect x="160" y="80" width="40" height="90" rx="12" :fill="previewColor" />
                      <!-- Kerah -->
                      <polygon points="90,60 110,30 150,30 170,60 130,60 130,90 110,90 110,60" fill="#e0e0e0" />
                      <!-- Kancing -->
                      <rect x="127" y="80" width="6" height="80" rx="3" fill="#bbb" />
                      <circle cx="130" cy="100" r="2" fill="#888" />
                      <circle cx="130" cy="120" r="2" fill="#888" />
                      <circle cx="130" cy="140" r="2" fill="#888" />
                      <circle cx="130" cy="160" r="2" fill="#888" />
                    </g>
                  </svg>
                </template>
                <!-- Gambar PNG/JPG lama dihapus, upload dan teks tetap -->
                <template x-if="uploadedImage">
                    <div
                        class="absolute z-20"
                        :style="`
                            left: calc(50% + ${uploadedX}px);
                            top: calc(50% + ${uploadedY}px);
                            width: ${uploadedWidth}px;
                            height: ${uploadedHeight}px;
                            transform: translate(-50%, -50%) rotate(${uploadedRotate}deg);
                        `"
                        @mousedown.prevent="dragging = true; dragOffsetX = $event.clientX - uploadedX; dragOffsetY = $event.clientY - uploadedY;"
                        @touchstart.prevent="dragging = true; dragOffsetX = $event.touches[0].clientX - uploadedX; dragOffsetY = $event.touches[0].clientY - uploadedY;"
                    >
                        <img
                            :src="uploadedImage"
                            alt="Upload"
                            class="w-full h-full object-contain cursor-move"
                            draggable="false"
                            style="pointer-events: none;"
                        />
                        <!-- Handle resize pojok kanan bawah -->
                        <div
                            class="absolute right-0 bottom-0 w-6 h-6 bg-white rounded-full border border-gray-300 flex items-center justify-center cursor-se-resize z-30"
                            @mousedown.prevent="resizing = true; resizeStartX = $event.clientX; resizeStartY = $event.clientY; resizeStartWidth = uploadedWidth; resizeStartHeight = uploadedHeight;"
                            @touchstart.prevent="resizing = true; resizeStartX = $event.touches[0].clientX; resizeStartY = $event.touches[0].clientY; resizeStartWidth = uploadedWidth; resizeStartHeight = uploadedHeight;"
                        >
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 19l4 0 0-4"/><path d="M19 19l-6-6"/></svg>
                        </div>
                        <!-- Tombol hapus pojok kiri atas -->
                        <button
                            class="absolute left-0 top-0 w-6 h-6 bg-white rounded-full border border-gray-300 flex items-center justify-center z-30"
                            @click="uploadedImage = null"
                            type="button"
                        >
                            <svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M6 6l12 12M6 18L18 6"/></svg>
                        </button>
                    </div>
                </template>
                <template x-if="previewText">
                    <div
                        class="absolute z-30 select-none"
                        :style="`
                            left: calc(50% + ${textX}px);
                            top: calc(70% + ${textY}px);
                            width: ${textWidth}px;
                            height: ${textHeight}px;
                            transform: translate(-50%, -50%) rotate(${textRotate}deg);
                        `"
                        @mousedown.prevent="textDragging = true; textDragOffsetX = $event.clientX - textX; textDragOffsetY = $event.clientY - textY;"
                        @touchstart.prevent="textDragging = true; textDragOffsetX = $event.touches[0].clientX - textX; textDragOffsetY = $event.touches[0].clientY - textY;"
                    >
                        <div
                            class="w-full h-full flex items-center justify-center cursor-pointer"
                            @dblclick="textEditing = true"
                        >
                            <template x-if="!textEditing">
                                <span class="font-bold text-center break-words" :style="`font-size: ${textFontSize}px; color: ${textColor};`" x-text="previewText"></span>
                            </template>
                            <template x-if="textEditing">
                                <input
                                    type="text"
                                    x-model="previewText"
                                    @blur="textEditing = false"
                                    class="w-full h-full text-center font-bold text-black bg-white bg-opacity-80 border border-blue-400 rounded"
                                    autofocus
                                />
                            </template>
                        </div>
                    </div>
                </template>
            </div>
            <!-- Kontrol rotasi dan ukuran teks -->
            <div class="flex flex-col items-center gap-2 mb-4" x-show="previewText">
                <div class="flex flex-col items-center mt-2">
                    <label class="text-sm">Rotasi Teks: <span x-text="textRotate"></span>°</label>
                    <input type="range" min="-180" max="180" step="1" x-model="textRotate" class="w-32">
                </div>
                <div class="flex items-center gap-4 mt-4">
                    <button type="button" @click="textFontSize = Math.max(8, textFontSize - 2)" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-2xl font-bold shadow hover:bg-gray-300 transition">-</button>
                    <span class="text-base font-semibold">Ukuran: <span x-text="textFontSize"></span></span>
                    <button type="button" @click="textFontSize = Math.min(120, textFontSize + 2)" class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-2xl font-bold shadow hover:bg-gray-300 transition">+</button>
                </div>
            </div>
            <!-- Kontrol rotasi gambar yang diunggah -->
            <div class="flex flex-col items-center gap-2 mb-4" x-show="uploadedImage">
                <div class="flex flex-col items-center mt-2">
                    <label class="text-sm">Rotasi Gambar: <span x-text="uploadedRotate"></span>°</label>
                    <input type="range" min="-180" max="180" step="1" x-model="uploadedRotate" class="w-32">
                </div>
            </div>
            <!-- Form Dinamis -->
            <div class="w-full max-w-md">
                <div x-show="tab === 'produk'">
                    <label class="block mb-2 font-semibold">Jenis Produk</label>
                    <select x-model="produk" class="block w-full rounded-md border-gray-300 shadow-sm">
                        <option value="kaos">Kaos</option>
                        <option value="kemeja">Kemeja</option>
                        <option value="hoodie">Hoodie</option>
                        <option value="jaket">Jaket</option>
                    </select>
                </div>
                <div x-show="tab === 'warna'">
                    <label class="block mb-2 font-semibold">Pilih Warna Produk</label>
                </div>
                @if(isset($warnaBahan))
                    <div x-show="tab === 'warna'">
                        @foreach($warnaBahan as $bahan => $warnas)
                            <div class="mb-2">
                                <div class="font-semibold text-sm mb-1">{{ $bahan }}</div>
                                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    @foreach($warnas as $warna)
                                        <div style="text-align: center; cursor:pointer;"
                                            x-on:click="previewColor = '{{ $warna['hex'] }}'">
                                            <!-- stylelint-disable-next-line -->
                                            <div style="width: 32px; height: 32px; border-radius: 50%; background: {{ $warna['hex'] }}; border: 2px solid #ccc; margin-bottom: 2px; display: inline-block;"></div>
                                            <div style="font-size: 10px;">{{ $warna['nama'] }}</div>
                                        </div>
                                    @endforeach
                                </div>
                            </div>
                        @endforeach
                    </div>
                @else
                    <div x-show="tab === 'warna'">
                        <input type="color" x-model="previewColor" class="h-10 w-20 border-none p-0 bg-transparent" />
                    </div>
                @endif
                <div x-show="tab === 'unggah'">
                    <label class="block mb-2 font-semibold">Upload Gambar</label>
                    <input type="file" @change="updateImage($event)" class="block w-full" />
                </div>
                <div x-show="tab === 'teks'">
                    <label class="block mb-2 font-semibold">Teks Custom</label>
                    <input type="text" x-model="previewText" class="block w-full border rounded px-3 py-2" placeholder="Masukkan teks..." />
                    <label class="block mt-4 mb-1 font-semibold">Warna Teks</label>
                    <input type="color" x-model="textColor" class="h-10 w-20 border-none p-0 bg-transparent" />
                </div>
                <button type="button"
                    @click="downloadPreview"
                    class="mt-6 px-8 py-2 rounded-md bg-[#1e335f] text-white font-semibold hover:bg-[#162547] transition">
                    Submit & Download
                </button>
            </div>
        </div>
    </div>
    

</div>
</x-layout> 
